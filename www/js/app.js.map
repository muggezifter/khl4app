{"version":3,"sources":["../../src/app.jsx"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["(function () {\r\n\r\n    /**\r\n     * Holds recording start time\r\n     */\r\n    var recStartTime = null;\r\n\r\n    /**\r\n     * Settings for the app:\r\n     * url: the url of the khl4server\r\n     * ticks: How many ticks between requests. 1 tick is ~ 500ms\r\n     */\r\n    var settings = {\r\n        url: \"https://khl4.localtunnel.me\",\r\n        //url: \"http://localhost:8080\",\r\n        ticksPerUpdate: 20,\r\n        tickLength: 500\r\n    }\r\n\r\n    /**\r\n     * Object that holds state for the various components\r\n     */\r\n    var state = {\r\n        info: {\r\n            rec_id: \"[not recording]\",\r\n            number: \"0000\",\r\n            time: \"00:00:00\"\r\n        },\r\n        grid: {\r\n            classname: [\"control\"]\r\n        },\r\n        status: {\r\n            classname: [\"control\"]\r\n        },\r\n        levels: [\r\n            {label: \"--\", level: \"0\"},\r\n            {label: \"--\", level: \"0\"},\r\n            {label: \"--\", level: \"0\"}\r\n        ]\r\n    }\r\n\r\n    /**\r\n     * Midi note number to human readable note name\r\n     *\r\n     * @param m\r\n     * @returns {string}\r\n     */\r\n    var m2n = m => ['c', 'c \\u266F', 'd', 'd \\u266F', 'e', 'f', 'f \\u266F', 'g', 'g \\u266F', 'a', 'a \\u266F', 'b'][m % 12];\r\n\r\n    /**\r\n     * Initialize recording: on the server a new record is made in the db. Set the recording id.\r\n     *\r\n     * @returns {khl}\r\n     */\r\n    var initRec = callback => {\r\n        jQuery.getJSON(settings.url + \"/recording/start?callback=?\")\r\n            .done(data => {\r\n                state.info.rec_id = data.recording_id;\r\n                callback();\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Stop and start recording\r\n     * @returns {boolean}\r\n     */\r\n    var toggleRec = () => {\r\n        if (recStartTime === null) {\r\n            // start recording\r\n            state.status.classname.push(\"recording\");\r\n            recStartTime = new Date();\r\n        } else {\r\n            // stop recording\r\n            state.status.classname = state.status.classname.filter(function (v) {\r\n                return (v !== \"recording\")\r\n            });\r\n            state.levels = getZeroLevels();\r\n            recStartTime = null;\r\n        }\r\n        return (recStartTime !== null);\r\n    }\r\n\r\n    /**\r\n     * End recording\r\n     */\r\n    var endRec = callback => {\r\n        jQuery.getJSON(settings.url + \"/recording/stop?rec_id=\" + state.info.rec_id + \"&callback=?\")\r\n            .done(data => {\r\n                console.log(data);\r\n                state.grid.classname = [\"control\"];\r\n                state.info.rec_id = \"[not recording]\";\r\n                callback();\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Translate the received data (the chord) into class names for the grid control\r\n     * @param data\r\n     */\r\n    var getGridClassName = data => [\"control\"]\r\n        .concat(\r\n        data\r\n            .filter(v => v.hasOwnProperty(\"note\"))\r\n            .map(v => \"midi\" + v.note)\r\n    );\r\n\r\n\r\n    /**\r\n     * Update the levels data in state object\r\n     * @param data\r\n     */\r\n    var getLevels = data => data.filter(v => v.hasOwnProperty(\"note\"))\r\n        .map(v =>({\"label\": m2n(v.note), \"level\": 100 / 127 * v.velocity}));\r\n\r\n\r\n    /**\r\n     * Reset the levels data in state object\r\n     */\r\n    var getZeroLevels = () => ([\r\n        {label: \"--\", level: \"0\"},\r\n        {label: \"--\", level: \"0\"},\r\n        {label: \"--\", level: \"0\"}\r\n    ]);\r\n\r\n    /**\r\n     * Get the elapsed time since beginning the recordimg\r\n     */\r\n    var getUpdatedTime = () => new Date((new Date() - recStartTime) - 3600000)\r\n        .toTimeString()\r\n        .replace(/.*(\\d{2}:\\d{2}:\\d{2}).*/, \"$1\");\r\n\r\n    /**\r\n     * Send current position to the server, receive back the calculated chord\r\n     *\r\n     */\r\n    var updatePos = function () {\r\n        var number = \"0000\" + ( parseInt(state.info.number) + 1);\r\n        number = number.substr(number.length - 4);\r\n\r\n        navigator.geolocation.getCurrentPosition(\r\n            function (pos) {\r\n                var lon = pos.coords.longitude;\r\n                var lat = pos.coords.latitude;\r\n                jQuery.getJSON([\r\n                    settings.url,\r\n                    \"/recording/node?nr=\", state.info.number,\r\n                    \"&rec_id=\", state.info.rec_id,\r\n                    \"&lat=\", lat,\r\n                    \"&lon=\", lon,\r\n                    \"&callback=?\"\r\n                ].join(\"\"))\r\n                    .done(function (data) {\r\n                        state.grid.classname = getGridClassName(data);\r\n                        state.levels = getLevels(data);\r\n                        console.log(data);\r\n                    })\r\n            }, function (err) {\r\n                console.warn('ERROR(' + err.code + '): ' + err.message);\r\n            }, {\r\n                enableHighAccuracy: true,\r\n                timeout: 5000,\r\n                maximumAge: 0\r\n            });\r\n\r\n        state.info.number = number;\r\n    }\r\n\r\n\r\n    /**\r\n     * Root object for the app\r\n     */\r\n    var KhlApp = React.createClass({\r\n        clockHandle: 0,\r\n        tick: 0,\r\n        getInitialState: () => ({data: state}),\r\n        // toggle handler to be passed to the status control\r\n        toggleClock: function () {\r\n            if (toggleRec()) {\r\n                // initialize recording\r\n                initRec(()=> {\r\n                    // start the clock\r\n                    this.clockHandle = setInterval(() => {\r\n                        if (++this.tick > settings.ticksPerUpdate) {\r\n                            updatePos();\r\n                            this.tick = 0;\r\n                        }\r\n                        state.info.time = getUpdatedTime();\r\n                        this.setState(state);\r\n                    }, settings.tickLength)\r\n                });\r\n            } else {\r\n                // stop the clock\r\n                clearInterval(this.clockHandle);\r\n                endRec(() => {\r\n                    this.setState(state)\r\n                });\r\n            }\r\n            this.setState(state);\r\n        },\r\n        render: function () {\r\n            return (\r\n                <div className=\"khlApp\">\r\n                    <StatusControl data={ this.state.data } toggleHandler= { this.toggleClock } />\r\n                    <GridControl data={ this.state.data } />\r\n                    <LevelControl data = { this.state.data} />\r\n                    <InfoControl data={ this.state.data } />\r\n                </div>\r\n            );\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Status component: has start toggle and status indicators\r\n     */\r\n    var StatusControl = React.createClass({\r\n        render: function () {\r\n            return (\r\n                <div id=\"status\" className={ this.props.data.status.classname.join(\" \") }>\r\n                    <div>\r\n                        <button id=\"toggle_rec\" onClick={ this.props.toggleHandler }></button>\r\n                    </div>\r\n                    <StatusIndicator params={{label: \"rec\", id: \"rec_indicator\"}} />\r\n                {/*<StatusIndicator params={{label: \"send\", id: \"send_indicator\"}} />*/}\r\n                </div>\r\n            );\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Status indicator: takes 2 params: label and id\r\n     */\r\n    var StatusIndicator = React.createClass({\r\n        render: function () {\r\n            return (\r\n                <div id= { this.props.params.id } className=\"indicator\">\r\n                    <svg viewBox=\"0 0 10 10\">\r\n                        <circle cx=\"5\" cy=\"5\" r=\"4\"/>\r\n                    </svg>\r\n                    <span className=\"label\">{ this.props.params.label }</span>\r\n                </div>\r\n            );\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Grid component, visual feedback\r\n     */\r\n    var GridControl = React.createClass({\r\n        render: function () {\r\n            return (\r\n                <div id=\"grid\" className={ this.props.data.grid.classname.join(\" \") }>\r\n                    <svg viewBox=\"0 0 264 128\">\r\n                        <polyLine points=\"192,12 12,12 42,64 72,12 102,64 132,12 162,64 192,12\r\n                        222,64 42,64 72,116 102,64 132,116 162,64 192,116 222,64 252,116 72,116\"/>\r\n\r\n                        <circle id=\"c1\" cx=\"12\" cy=\"12\" r=\"10\"/>\r\n                        <circle id=\"c2\" cx=\"72\" cy=\"12\" r=\"10\"/>\r\n                        <circle id=\"c3\" cx=\"132\" cy=\"12\" r=\"10\"/>\r\n                        <circle id=\"c4\" cx=\"192\" cy=\"12\" r=\"10\"/>\r\n\r\n                        <circle id=\"c5\" cx=\"42\" cy=\"64\" r=\"10\"/>\r\n                        <circle id=\"c6\" cx=\"102\" cy=\"64\" r=\"10\"/>\r\n                        <circle id=\"c7\" cx=\"162\" cy=\"64\" r=\"10\"/>\r\n                        <circle id=\"c8\" cx=\"222\" cy=\"64\" r=\"10\"/>\r\n\r\n                        <circle id=\"c9\" cx=\"72\" cy=\"116\" r=\"10\"/>\r\n                        <circle id=\"c10\" cx=\"132\" cy=\"116\" r=\"10\"/>\r\n                        <circle id=\"c11\" cx=\"192\" cy=\"116\" r=\"10\"/>\r\n                        <circle id=\"c12\" cx=\"252\" cy=\"116\" r=\"10\"/>\r\n                    </svg>\r\n                </div>\r\n            );\r\n        }\r\n    });\r\n\r\n    var LevelControl = React.createClass({\r\n        render: function () {\r\n            return (\r\n                <div id=\"level\" className=\"control level\">\r\n                    <LevelBar params={{\r\n                        label: this.props.data.levels[0].label,\r\n                        level: this.props.data.levels[0].level\r\n                    }}  />\r\n                    <LevelBar params={{\r\n                        label: this.props.data.levels[1].label,\r\n                        level: this.props.data.levels[1].level\r\n                    }}  />\r\n                    <LevelBar params={{\r\n                        label: this.props.data.levels[2].label,\r\n                        level: this.props.data.levels[2].level\r\n                    }}  />\r\n                </div>\r\n            );\r\n        }\r\n    });\r\n\r\n    var LevelBar = React.createClass({\r\n        render: function () {\r\n            return (\r\n                <div className=\"bar\">\r\n                    <span className=\"label\">{ this.props.params.label }</span>\r\n                    <div className=\"outer\">\r\n                        <div className=\"inner\" style={{width: this.props.params.level + \"%\"}}></div>\r\n                    </div>\r\n                </div>\r\n            )\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Info component, textual feedback\r\n     */\r\n    var InfoControl = React.createClass({\r\n        render: function () {\r\n            //console.log(\"InfoControl render\", this.props.data)\r\n            return (\r\n                <div id=\"info\" className=\"control\">\r\n                    <div id=\"rec_id\">id: {this.props.data.info.rec_id}</div>\r\n                    <div id=\"number\">{this.props.data.info.number}</div>\r\n                    <div id=\"time\">{this.props.data.info.time}</div>\r\n                </div>\r\n            );\r\n        }\r\n    });\r\n\r\n\r\n    ReactDOM.render(\r\n        <KhlApp />,\r\n        document.getElementById('container')\r\n    );\r\n\r\n}());\r\n\r\n/*\r\n 1446585716501:/khl?nr=0001&lat=51.8861799&lon=4.4625571&callback=jQuery211049043411714956164_1446585704690&_=1446585704691\r\n 1446585718036:/khl?nr=0002&lat=51.8861794&lon=4.462556&callback=jQuery211049043411714956164_1446585704690&_=1446585704692\r\n 1446585724079:/khl?nr=0003&lat=51.8861794&lon=4.462556&callback=jQuery211049043411714956164_1446585704690&_=1446585704693\r\n 1446585729267:/khl?nr=0004&lat=51.8861794&lon=4.462556&callback=jQuery211049043411714956164_1446585704690&_=1446585704694\r\n 1446585735273:/khl?nr=0005&lat=51.8861794&lon=4.462556&callback=jQuery211049043411714956164_1446585704690&_=1446585704695\r\n 1446585740362:/khl?nr=0006&lat=51.8861794&lon=4.462556&callback=jQuery211049043411714956164_1446585704690&_=1446585704696\r\n 1446585746402:/khl?nr=0007&lat=51.8861794&lon=4.462556&callback=jQuery211049043411714956164_1446585704690&_=1446585704697\r\n 1446585751317:/khl?nr=0008&lat=51.8861794&lon=4.462556&callback=jQuery211049043411714956164_1446585704690&_=1446585704698\r\n 1446585757330:/khl?nr=0009&lat=51.8861794&lon=4.462556&callback=jQuery211049043411714956164_1446585704690&_=1446585704699\r\n */\r\n"]}